<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>Project 1 Submission</title>
      <h1>London's Cholera Outbreak</h1>
      <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
      <script type="text/javascript" src="https://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
      <style>

body { font: 12px Arial;}

.axis path, .axis line {
         fill: none;
         stroke: black;
         stroke-width: 3;
         shape-rendering: crispEdges;
         }
         rect {
         stroke: white;
         }
         circle {
         fill: #dfb8ff;
         }
         .bar1 {
         fill: steelblue;
         }
         .bar2 {
         fill: orange;
         }
         div.tooltip { 
         position: absolute;     
         text-align: center;     
         width: 90px;          
         height: 30px;         
         padding: 2px;       
         font: 12px sans-serif;    
         background: lightcyan;     
         }
         path { 
         fill: none;
         }
      </style>
   </head>
   <body>
	 <div>
      <div style="margin-left: 1200px;">
        <a href="README.md"><button class="button">Documentation Page</button></a>
        <a href="Youtube.html"><button class="button">Youtube Video</button></a>
      </div>
    </div>
      <div id="option">
        <input name="Gender" 
            type="button" 
            value="See by Gender" 
            onclick="updateByGender()" />
        <input name="Age" 
            type="button" 
            value="See by Age" 
            onclick="updateByAge()" />
    </div>

    <script type="text/javascript">
        var width  = 740;
        var height = 575;
        var w = 90;
        var h = 90;
        var i;
         
        var selectdiv = d3.select("body").append("div");     
        var setElement = {top: 35, right: 25, bottom: 35, left: 55},
        SetWidth = 500 - setElement.left - setElement.right,
        SetHeight = 300 - setElement.top - setElement.bottom;
         
         var zoom = d3.behavior.zoom().on("zoom", functionToZoom);
         
         var svgContainer = d3.select("body")
             .append("svg")
             .attr("height", height)
             .attr("width", width)
             .call(zoom);
             
         
         var TimeVar = d3.time.format("%e %B");
         var DateVar = d3.time.format("%d-%b").parse;

         
         var y = d3.scale.linear().range([SetHeight, 0]);         
         var x = d3.time.scale().range([0, SetWidth]);

         
         var SetyAxis = d3.svg.axis().scale(y).orient("left").ticks(7);         
         var SetxAxis = d3.svg.axis().scale(x).orient("bottom").ticks(6);

         
         // Define the line
         var valueline = d3.svg.line().x(function(d) { return x(d.date); }).y(function(d) { return y(d.death); });
             
         // Adds the svg canvas
         var LeftChart = d3.select("body")
                         .append("svg")
                         .attr("width", SetWidth + setElement.left - setElement.right)
                         .attr("height", 2.5*SetHeight + setElement.top + setElement.bottom)
                         .append("g")
                         .attr("transform", "translate(30,15)");

         
         function functionToZoom() {
             svgContainer.attr("transform",
                 "translate(" + zoom.translate() + ")" +
                 "scale(" + zoom.scale() + ")"
             );
         }
         
          var street = [{name:'CEORCE STREET',x:120,y:222,rotate:72},{name:'BREWER STREET',x:355,y:390,rotate:-43},
                       {name:'RECENT STREET',x:235,y:250,rotate:60},{name:'OXFORD STREET',x:298,y:79,rotate:-10},
                       {name:'DEAN STREET',x:490,y:89,rotate:66},{name:'WORK',x:321.5,y:179,rotate:-23},
                       {name:'HOUSE',x:325,y:192,rotate:-23},{name:'Bre.',x:411,y:212,rotate:65}]
          var BreweryProperties = [{x:417,y:207.5,w:40,h:20}]         
          var WorkHouseProperties = [{x:311,y:170,w:50,h:40}]
         

         
         
         d3.csv("streets.txt", function(data) 
         {     
            for (i=0; i<data.length; i++)
            {
                var dataset=data[i].xy.split(/\s+/);
                          
                function isInteger(obj) 
                {
                    return obj%1 === 0
                }
         
                if(isInteger(dataset[0]))
                {       
                    var sdata = Array.apply(1,{length: dataset[1]}).map(function(item,j=1)
                    {
                    j++;
                    return {x: data[i + j].xy.split(/\s+/)[0]*30, y: data[i + j].xy.split(/\s+/)[1]*30}
                    });
         
                    var lineFunction=d3.svg.line()
                                            .x(function(d) { return d.x;})
                                            .y(function(d) { return height-d.y; })
                                            .interpolate("linear");
         
                lineFunction(sdata);
             
                var svgPath = svgContainer.append("path").attr("stroke", "black")
                .attr("stroke-width", "2px").attr("fill", "none");
                     svgPath.attr("d", lineFunction(sdata));
                           
                 }
             }        
         });
         
         
         d3.csv("pumps.txt", function(data) 
         {
            var sdata = Array.apply(1,{length: 13}).map(function(item,j=1)
            {
                j++;
                return {x: data[j -1].xy.split(/\s+/)[0]*30, y: data[j - 1].xy.split(/\s+/)[1]*30}
            });
         
            svgContainer.selectAll("rect").data(sdata)
                        .enter().append("rect")
                        .attr("x", function( d) { return d.x ; })
                        .attr("y", function(d ) { return height - d.y; })
                        .attr("stroke-opacity",0.6);
         
         
            var SetWorkHouseProperties = svgContainer.append("rect")
                                    .data(WorkHouseProperties)
                                    .attr("transform", function (d) 
                                    { return "rotate(" + d.rotate+ " " +d.x +"," +d.y+ ")"; })

                                    .attr("x", function(d) { return d.x; })
                                    .attr("y", function(d) { return d.y; })
                                    .attr("height", function(d) { return d.h;})
                                    .attr("width", function(d) { return d.w;})
                                    .attr("stroke", 'grey')
                                  
                                    .style("fill", "#DFFF00"); 
                     
                   var SetBreweryProperties = svgContainer.append("rect")
                   .data(BreweryProperties)
                   .attr("transform", function (d) 
                     { return "rotate(" + d.rotate + " " + d.x + "," + d.y+ ")"; })
                   .attr("x", function(d) { return d.x; })
                   .attr("y", function(d) { return d.y; })
                   .attr("height", function(d) { return d.h; })
                   .attr("width", function(d) { return d.w; })
                   .style("fill", "#40E0D0");       
         
                 //Setting streets
                     svgContainer.selectAll(".place-label")
                       .data(street)
                       .enter().append("text")
                       .attr("class", "place-label")
                       .attr("transform", function (d) 
                         { return "rotate(" +d.rotate + " " +d.x + "," +d.y+ ")"; })
                       .attr("x", function(d) { return d.x; })
                       .attr("y", function(d) { return d.y; })
                 
                        .attr("dy", ".30em")
                 
                        .text(function(d) { return d.name; });        
         });
                 
    function type(d) 
    {
        d.male = +d.female;
        return d;
    }
         
    function updateByAge()
    {
        d3.selectAll("circle").remove();
        d3.csv("deaths_age_sex.txt", function(data) 
        {
            var sdata = Array.apply(1,{length: data.length}).map(function(item,j=1)
            {
                j++;
                return {x: data[j-1].deaths.split(/\s+/)[0]*30, y: data[j-1].deaths.split(/\s+/)[1]*30, age:data[j-1].deaths.split(/\s+/)[2], mf:data[j-1].deaths.split(/\s+/)[3] }
            });
         
        var color = ['#FFFF00', '#808000', '#00FF00', '#008000', '#FF00FF', '#800080']
        svgContainer.selectAll("circle")
                     .data(sdata)
                     .enter().append("circle")
                     .attr("cx", function(d) { return d.x; })
                     .attr("cy", function(d) { return height-d.y; })
                     .attr("r", 5)
                     .style("fill", function(d) { return color[d.age]; })
                     .attr("stroke", 'black')
                     .attr("stroke-opacity",2);
        });
         
    }
         
    function updateByGender()
    {
        d3.selectAll("circle").remove();
        d3.csv("deaths_age_sex.txt", function(data) 
        {
            var sdata = Array.apply(1,{length: data.length}).map(function(item,j=1)
            {
                j++;
                return {x: data[j-1].deaths.split(/\s+/)[0]*30, y: data[j - 1].deaths.split(/\s+/)[1]*30, age:data[ j - 1].deaths.split(/\s+/)[2], mf:data[j - 1].deaths.split(/\s+/)[3] }
            });
   
        var color = ["blue","orange"]
        svgContainer.selectAll("circle")
                     .data(sdata)
                     .enter().append("circle")
                     .attr("cx", function(d) { return d.x; })
                     .attr("cy", function(d) { return height-d.y; })
                     .attr("r", 5)
                     .style("fill", function(d) { return color[d.mf]; })
                     .attr("stroke", "black")
                     .attr("stroke-width", "1px")
        });
         
    }
         
    d3.csv("deathdays.txt",function(data)
    {
        var sdata = Array.apply(1,{length: data.length}).map(function(item,j=1)
        {
            j++;
            return {date: data[j-1].xy.split(/\s+/)[0], death: data[j-1].xy.split(/\s+/)[1]}
        });
         
        sdata.forEach(function(d) 
        {
            d.date = DateVar(d.date);
            d.death = +d.death;
        });

        x.domain(d3.extent(sdata, function(d) { return d.date; }));
        y.domain([0, d3.max(sdata, function(d) { return d.death; })]);
        LeftChart.append("path")
                .attr("class", "line")
                .attr("d", valueline(sdata))
                .attr("stroke", "grey")
                .attr("stroke-width", "2px");
         
        LeftChart.selectAll("dot")  
                .data(sdata)     
                .enter().append("ellipse")                 
                .attr("cx", function(d) { return x(d.date); })     
                .attr("cy", function(d) { return y(d.death); })
                .attr("rx", 3.0) 
                .attr("ry", 3.0)
   
                .on("mouseover",function(d, i)
                {
                    d3.selectAll("circle").remove();
                    var l=0;
                    for (a=0; a<=i; a++)
                    {
                        l= l+ sdata[a].death;
                    }
         
         
       
                    d3.csv("deaths_age_sex.txt", function(data) 
                    {
                        var sdata1 = Array.apply(1,{length: l}).map(function(item,j=1)
                        {
                            j++;
                            return {x: data[j-1].deaths.split(/\s+/)[0]*30, y: data[j-1].deaths.split(/\s+/)[1]*30, age:data[j-1].deaths.split(/\s+/)[2], mf:data[j-1].deaths.split(/\s+/)[3] }
                        });
                        
                        var color = ['#FFFF00', '#808000', '#00FF00', '#008000', '#FF00FF', '#800080']
         
                        svgContainer.selectAll("circle")
                                    .data(sdata1)
                                    .enter().append('circle')
                                    .attr("cx", function(d) { return d.x; })
                                    .attr("cy", function(d) { return height-d.y; })
                                    .attr("r", 5)
                                    .style("fill", function(d) { return color[d.age]; })
                                    .attr("stroke", "black")
                                    .attr("stroke-width", "2px")
                    });
         
                });
            
         
        LeftChart.append("g")
             .attr("class", "x axis")
             .attr("transform", "translate(0," + SetHeight + ")")
             .call(SetxAxis);
         
        LeftChart.append("g")
             .attr("class", "y axis")
             .call(SetyAxis)
             .append("text")
             .attr("x", -30)
             .attr("y", -2)
             .text("Total Deaths");
         
         LeftChart.append("rect")
         .attr("x", 0)
         .attr("y", 370)
         .attr("width", 10)
         .attr("height", 10)
         .style("fill", "black")
         .style("stroke","grey")
         .style("stroke-width",0.6);
         
         LeftChart.append("rect")
         .attr("x", 0)
         .attr("y", 390)
         .attr("width", 10)
         .attr("height", 10)
         .style("fill", "#DFFF00")
         .style("stroke-width",0.6);

         LeftChart.append("rect")
         .attr("x", 0)
         .attr("y", 410)
         .attr("width", 10)
         .attr("height", 10)
         .style("fill", "#40E0D0")
         .style("stroke-width",0.6);         
		 
         var label = [
		 			{x:155,y:395,color:"orange"},
					{x:155,y:375,color:"blue"},
                    {x:275,y:375,color:"#FFFF00"},{x:275,y:395,color:"#808000"},{x:275,y:415,color:"#00FF00"},
                    {x:275,y:435,color:"#008000"},{x:275,y:455,color:"#FF00FF"},{x:275,y:475,color:"#800080"}
                    ]
         
         LeftChart.selectAll("dot")  
             .data(label)     
             .enter().append("ellipse")                 
             .attr("cx", function(d) { return d.x; })     
             .attr("cy", function(d) { return d.y; })
             .attr("rx", 5) 
             .attr("ry", 5)
             .style("fill", function(d) { return d.color; }) 
             .style("stroke","grey")
             .style("stroke-width",1); 
         
         var LabelNames = [{name:'Streets Chart Label',x:0,y:350},
		 			{name:'Pumps Location',x:20,y:380},
					{name:'Work House Location',x:20,y:400},
                    {name:'Brewery Location',x:20,y:420},
                   
				    {name:'Gender Label',x:150,y:350},
				    {name:'Male',x:170,y:380},
					{name:'Female',x:170,y:400},
                    
					{name:'Age Label',x:270,y:350},
					{name:'0-10',x:290,y:380},
					{name:'11-20',x:290,y:400},
					{name:'21-40',x:290,y:420},
                    {name:'41-60',x:290,y:440},
					{name:'61-80',x:290,y:460},
					{name:'>80',x:290,y:480},
					{name:'Count of Deaths Per Day',x:150,y:280}]
         
         LeftChart.selectAll(".place-label")
               .data(LabelNames)
               .enter().append("text")
               .attr("class", "place-label")
               .attr("x", function(d) { return d.x; })
               .attr("y", function(d) { return d.y; })
			   .text(function(d) { return d.name; });
			   
	});
			   
    </script>
	</body>
</html>
